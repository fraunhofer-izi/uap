# This is the rnaseq-pipeline configuration file.
project-id: "TesTsetup"
destination_path: "/gpfs1/data/bioinf/projects/data/rna-seq-devel/sven_current"
notify: http://nhcham.org:13380/9j84dr9384dh92s9   # Sven
#notify: http://nhcham.org:13380/j4qoiodgeg9sv2nn   # Micha

constants:
    - &genome /data/bioinf/Data/Indices/hg19/hg19.fa
    - &segemehl_genome_index /data/bioinf/Data/Indices/hg19/hg19.idx
    - &bowtie2_genome_index /data/bioinf/genomes/data/animalia/chordata/mammalia/rodentia/homo_sapiens/hg19/indices/hg19


#    - &genome /gpfs1/data/bioinf/projects/data/rna-seq-devel/test_files/mtGenome/chrM.fa
 #   - &segemehl_genome_index /gpfs1/data/bioinf/projects/data/rna-seq-devel/test_files/mtGenome/chrM.idx
  #  - &bowtie2_genome_index /gpfs1/data/bioinf/projects/data/rna-seq-devel/test_files/mtGenome/chrM

steps:

    fastq_source:
        pattern: /data/bioinf/projects/data/rna-seq-devel/test_files/fastq_with_index/*.fastq.gz
        group: (R\d{3})-R[12].fastq.gz
        paired_end: yes
        indices:
            R334: TTAGGC
            R389: CAGATC


    cutadapt:
        _depends: fastq_source
        _volatile: false
        adapter-R1: AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC((INDEX))ATCTCGTATGCCGTCTTCTGCTTG
        adapter-R2: AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT
        fix_qnames: true

    fix_cutadapt:
        _depends: cutadapt
        _volatile: false


    fastqc_fix (fastqc):
        _depends: fix_cutadapt
        _volatile: false

#   fastqc_raw (fastqc):
#     _depends: fastq_source
#      _volatile: false

    segemehl:
        _depends: fix_cutadapt
        genome: *genome
        index: *segemehl_genome_index

    sort_by_chr_segemehl (sam_to_bam):
        _depends: segemehl
        sort_by_name: false
        genome: *genome


    realign (testrealign):
        _depends: sort_by_chr_segemehl
        genome: *genome

    sort_by_name_realigned (sam_to_bam):
        _depends: realign
        sort_by_name: true
        genome: *genome


    post_sawdust:
        _depends: sort_by_name_realigned
        library_type: fr-secondstrand
        seq_type: RNA

    sort_by_chr_post_sawdust (sam_to_bam):
         _depends: post_sawdust
         sort_by_name: false
         genome: *genome

    cufflinks:
        _depends: sort_by_chr_post_sawdust
        library_type: fr-secondstrand
        use_mask: /home/puppel/pca-retro/rnaseq-pipeline/cufflinks-mask-rRNA-tRNA-chrM.gtf


    cuffmerge:
        _depends: cufflinks
        genome: *genome
        run_id: magic
        reference: /data/bioinf/databases/proteom_databases/code/gencode/v18/data/gencode.v18.annotation.exon.forCuffmerge.gtf

    post_cufflinks_merge:
        _depends: cuffmerge
        remove_gencode: True
        remove_unstranded: False

    merge_gencode_novel_workaround:
        _depends:
            - post_cufflinks_merge
        reference: /data/bioinf/databases/proteom_databases/code/gencode/v18/data/gencode.v18.annotation.gtf

    count_genes (htseq_count):
         _depends:
            - post_sawdust
            - merge_gencode_novel_workaround
         stranded: 'yes'
         mode: intersection-strict
         type: exon
         idattr: gene_id




tools:
    fastqc:
        path: /gpfs1/data/bioinf/projects/code/projects_misc/Tools/FastQC/fastqc
        get_version: '--version'
    cutadapt:
        path: /home/spechtm/programming/cutadapt/cutadapt-1.2.1/bin/cutadapt
        get_version: '--version'
    pigz:
        path: pigz
        get_version: '--version'
    pigz4m:
        path: /home/abioinfg/pca_retro/rnaseq-pipeline/tools/pigz4m/pigz4m
        get_version: '--version'
    head:
        path: head
        get_version: '--version'
    sort:
        path: sort
        get_version: '--version'
    cat4m:
        path: ./tools/cat4m
    fix_cutadapt:
        path: ['./python_env/bin/python', './tools/fix_cutadapt.py']
        get_version: ''
        exit_code: 2
    post_sawdust:
        path: ['./python_env/bin/python', './tools/misc-bio-stuff/scripts/post_sawdust.py']
        get_version: ''
        exit_code: 2

    post_cufflinks_merge:
        path: ['./python_env/bin/python', './tools/misc-bio-stuff/scripts/post_cufflinks_merge.py']
        get_version: ''
        exit_code: 2


    fix_qnames:
        path: ['./python_env/bin/python', './tools/fix_qnames.py']
    remove_reads_segemehl:
        path: ['./python_env/bin/python', './tools/remove_reads_segemehl.py']
        exit_code: 1
    segemehl:
        path: '/data/bioinf/projects/code/projects_misc/Tools/SEGEMEHL/segemehl-04182013-mod-stdout/segemehl.x'
        get_version: ''
        exit_code: 255
    cufflinks:
        path: /home/spechtm/cufflinks/cufflinks-2.1.1.Linux_x86_64/cufflinks
        get_version: '--version'
        exit_code: 1
    cuffmerge:
        path: /home/spechtm/cufflinks/cufflinks-2.1.1.Linux_x86_64/cuffmerge
        get_version: '--version'
        exit_code: 0
    grep:
        path: grep
        get_version: '--version'
    htseq-count:
        path: /data/bioinf/projects/code/projects_misc/Ribolution/copd-retro/2013-01/tools/htseq-env/bin/htseq-count
        exit_code: 1
    curl:
        path: /usr/bin/curl
        get_version: '--version'
        exit_code: 2
    invertGood:
        path: /data/bioinf/projects/code/projects_misc/Ribolution/copd-retro/2013-01/tools/invertSamStrand/invertGood
    samtools:
        path: /gpfs1/data/bioinf/projects/code/projects_misc/Tools/samtools-0.1.19/samtools
        get_version: ''
        exit_code: 1
    tophat2:
        path: /home/spechtm/tophat-2.0.8b.Linux_x86_64/tophat2
        get_version: '--version'
    bowtie2:
        path: bowtie2
        get_version: '--version'
    s2c:
        path: ['./python_env/bin/python', './tools/s2c.py']
        exit_code: 2
    fix_s2c:
        path: ['./python_env/bin/python', './tools/fix_s2c.py']
        exit_code: 1
    testrealign:
        path: /home/hackermu/Downloads/segemehl_svn/segemehl/testrealign.x
        exit_code: 255
    random_sample_fastq:
        path: ['./python_env/bin/python', './tools/random_sample_fastq.py']
        get_version: '--version'
        exit_code: 2
